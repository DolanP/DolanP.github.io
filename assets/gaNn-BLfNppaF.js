var ue=Object.defineProperty;var zt=n=>{throw TypeError(n)};var fe=(n,e,s)=>e in n?ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[e]=s;var G=(n,e,s)=>fe(n,typeof e!="symbol"?e+"":e,s),Tt=(n,e,s)=>e.has(n)||zt("Cannot "+s);var Z=(n,e,s)=>(Tt(n,e,"read from private field"),s?s.call(n):e.get(n)),It=(n,e,s)=>e.has(n)?zt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,s),dt=(n,e,s,t)=>(Tt(n,e,"write to private field"),t?t.call(n,s):e.set(n,s),s),Nt=(n,e,s)=>(Tt(n,e,"access private method"),s);import"./modulepreload-polyfill-B5Qt9EMX.js";/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const _t="168";function ce(n,e,s){return Math.max(e,Math.min(s,n))}class st{constructor(e=0,s=0){st.prototype.isVector2=!0,this.x=e,this.y=s}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,s){return this.x=e,this.y=s,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,s){switch(e){case 0:this.x=s;break;case 1:this.y=s;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,s){return this.x=e.x+s.x,this.y=e.y+s.y,this}addScaledVector(e,s){return this.x+=e.x*s,this.y+=e.y*s,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,s){return this.x=e.x-s.x,this.y=e.y-s.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const s=this.x,t=this.y,o=e.elements;return this.x=o[0]*s+o[3]*t+o[6],this.y=o[1]*s+o[4]*t+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,s){return this.x=Math.max(e.x,Math.min(s.x,this.x)),this.y=Math.max(e.y,Math.min(s.y,this.y)),this}clampScalar(e,s){return this.x=Math.max(e,Math.min(s,this.x)),this.y=Math.max(e,Math.min(s,this.y)),this}clampLength(e,s){const t=this.length();return this.divideScalar(t||1).multiplyScalar(Math.max(e,Math.min(s,t)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const s=Math.sqrt(this.lengthSq()*e.lengthSq());if(s===0)return Math.PI/2;const t=this.dot(e)/s;return Math.acos(ce(t,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const s=this.x-e.x,t=this.y-e.y;return s*s+t*t}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,s){return this.x+=(e.x-this.x)*s,this.y+=(e.y-this.y)*s,this}lerpVectors(e,s,t){return this.x=e.x+(s.x-e.x)*t,this.y=e.y+(s.y-e.y)*t,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,s=0){return this.x=e[s],this.y=e[s+1],this}toArray(e=[],s=0){return e[s]=this.x,e[s+1]=this.y,e}fromBufferAttribute(e,s){return this.x=e.getX(s),this.y=e.getY(s),this}rotateAround(e,s){const t=Math.cos(s),o=Math.sin(s),r=this.x-e.x,i=this.y-e.y;return this.x=r*t-i*o+e.x,this.y=r*o+i*t+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:_t}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=_t);class Ut{constructor(e){G(this,"_input",{left:0,right:0});G(this,"direction",0);G(this,"position",new st(0,0));G(this,"extents",new st(8,8));G(this,"score",0);e||(e=[0,0]),this.position=new st(e[0],e[1])}input(e){this._input=e}step(e){const t=1*Math.PI,o=this._input,r=(o.left+o.right)/2*250,i=(o.right-o.left)*t;this.direction+=i*e,this.position.x+=Math.cos(this.direction)*r*e,this.position.y+=Math.sin(this.direction)*r*e}}function Wt(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var s=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};s.prototype=e.prototype}else s={};return Object.defineProperty(s,"__esModule",{value:!0}),Object.keys(n).forEach(function(t){var o=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(s,t,o.get?o:{enumerable:!0,get:function(){return n[t]}})}),s}var q={};const ae=Object.prototype.toString;function wt(n){const e=ae.call(n);return e.endsWith("Array]")&&!e.includes("Big")}const ge=Object.freeze(Object.defineProperty({__proto__:null,isAnyArray:wt},Symbol.toStringTag,{value:"Module"})),we=Wt(ge);function me(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wt(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var s=e.fromIndex,t=s===void 0?0:s,o=e.toIndex,r=o===void 0?n.length:o;if(t<0||t>=n.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(r<=t||r>n.length||!Number.isInteger(r))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var i=n[t],h=t+1;h<r;h++)n[h]>i&&(i=n[h]);return i}function pe(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!wt(n))throw new TypeError("input must be an array");if(n.length===0)throw new TypeError("input must not be empty");var s=e.fromIndex,t=s===void 0?0:s,o=e.toIndex,r=o===void 0?n.length:o;if(t<0||t>=n.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(r<=t||r>n.length||!Number.isInteger(r))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var i=n[t],h=t+1;h<r;h++)n[h]<i&&(i=n[h]);return i}function de(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(wt(n)){if(n.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var s;if(e.output!==void 0){if(!wt(e.output))throw new TypeError("output option must be an array if specified");s=e.output}else s=new Array(n.length);var t=pe(n),o=me(n);if(t===o)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var r=e.min,i=r===void 0?e.autoMinMax?t:0:r,h=e.max,l=h===void 0?e.autoMinMax?o:1:h;if(i>=l)throw new RangeError("min option must be smaller than max option");for(var u=(l-i)/(o-t),g=0;g<n.length;g++)s[g]=(n[g]-t)*u+i;return s}const ye=Object.freeze(Object.defineProperty({__proto__:null,default:de},Symbol.toStringTag,{value:"Module"})),Me=Wt(ye);Object.defineProperty(q,"__esModule",{value:!0});var U=we,Vt=Me;const yt=" ".repeat(2),Yt=" ".repeat(4);function Se(){return Qt(this)}function Qt(n,e={}){const{maxRows:s=15,maxColumns:t=10,maxNumSize:o=8,padMinus:r="auto"}=e;return`${n.constructor.name} {
${yt}[
${Yt}${Ee(n,s,t,o,r)}
${yt}]
${yt}rows: ${n.rows}
${yt}columns: ${n.columns}
}`}function Ee(n,e,s,t,o){const{rows:r,columns:i}=n,h=Math.min(r,e),l=Math.min(i,s),u=[];if(o==="auto"){o=!1;t:for(let g=0;g<h;g++)for(let f=0;f<l;f++)if(n.get(g,f)<0){o=!0;break t}}for(let g=0;g<h;g++){let f=[];for(let m=0;m<l;m++)f.push(be(n.get(g,m),t,o));u.push(`${f.join(" ")}`)}return l!==i&&(u[u.length-1]+=` ... ${i-s} more columns`),h!==r&&u.push(`... ${r-e} more rows`),u.join(`
${Yt}`)}function be(n,e,s){return(n>=0&&s?` ${Pt(n,e-1)}`:Pt(n,e)).padEnd(e)}function Pt(n,e){let s=n.toString();if(s.length<=e)return s;let t=n.toFixed(e);if(t.length>e&&(t=n.toFixed(Math.max(0,e-(t.length-e)))),t.length<=e&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let o=n.toExponential(e);return o.length>e&&(o=n.toExponential(Math.max(0,e-(o.length-e)))),o.slice(0)}function je(n,e){n.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},n.prototype.addS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)+t);return this},n.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)+t.get(o,r));return this},n.add=function(t,o){return new e(t).add(o)},n.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},n.prototype.subS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)-t);return this},n.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)-t.get(o,r));return this},n.sub=function(t,o){return new e(t).sub(o)},n.prototype.subtract=n.prototype.sub,n.prototype.subtractS=n.prototype.subS,n.prototype.subtractM=n.prototype.subM,n.subtract=n.sub,n.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},n.prototype.mulS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)*t);return this},n.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)*t.get(o,r));return this},n.mul=function(t,o){return new e(t).mul(o)},n.prototype.multiply=n.prototype.mul,n.prototype.multiplyS=n.prototype.mulS,n.prototype.multiplyM=n.prototype.mulM,n.multiply=n.mul,n.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},n.prototype.divS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)/t);return this},n.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)/t.get(o,r));return this},n.div=function(t,o){return new e(t).div(o)},n.prototype.divide=n.prototype.div,n.prototype.divideS=n.prototype.divS,n.prototype.divideM=n.prototype.divM,n.divide=n.div,n.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},n.prototype.modS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)%t);return this},n.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)%t.get(o,r));return this},n.mod=function(t,o){return new e(t).mod(o)},n.prototype.modulus=n.prototype.mod,n.prototype.modulusS=n.prototype.modS,n.prototype.modulusM=n.prototype.modM,n.modulus=n.mod,n.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},n.prototype.andS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)&t);return this},n.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)&t.get(o,r));return this},n.and=function(t,o){return new e(t).and(o)},n.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},n.prototype.orS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)|t);return this},n.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)|t.get(o,r));return this},n.or=function(t,o){return new e(t).or(o)},n.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},n.prototype.xorS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)^t);return this},n.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)^t.get(o,r));return this},n.xor=function(t,o){return new e(t).xor(o)},n.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},n.prototype.leftShiftS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)<<t);return this},n.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)<<t.get(o,r));return this},n.leftShift=function(t,o){return new e(t).leftShift(o)},n.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},n.prototype.signPropagatingRightShiftS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)>>t);return this},n.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)>>t.get(o,r));return this},n.signPropagatingRightShift=function(t,o){return new e(t).signPropagatingRightShift(o)},n.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},n.prototype.rightShiftS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)>>>t);return this},n.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)>>>t.get(o,r));return this},n.rightShift=function(t,o){return new e(t).rightShift(o)},n.prototype.zeroFillRightShift=n.prototype.rightShift,n.prototype.zeroFillRightShiftS=n.prototype.rightShiftS,n.prototype.zeroFillRightShiftM=n.prototype.rightShiftM,n.zeroFillRightShift=n.rightShift,n.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,~this.get(t,o));return this},n.not=function(t){return new e(t).not()},n.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.abs(this.get(t,o)));return this},n.abs=function(t){return new e(t).abs()},n.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.acos(this.get(t,o)));return this},n.acos=function(t){return new e(t).acos()},n.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.acosh(this.get(t,o)));return this},n.acosh=function(t){return new e(t).acosh()},n.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.asin(this.get(t,o)));return this},n.asin=function(t){return new e(t).asin()},n.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.asinh(this.get(t,o)));return this},n.asinh=function(t){return new e(t).asinh()},n.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.atan(this.get(t,o)));return this},n.atan=function(t){return new e(t).atan()},n.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.atanh(this.get(t,o)));return this},n.atanh=function(t){return new e(t).atanh()},n.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.cbrt(this.get(t,o)));return this},n.cbrt=function(t){return new e(t).cbrt()},n.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.ceil(this.get(t,o)));return this},n.ceil=function(t){return new e(t).ceil()},n.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.clz32(this.get(t,o)));return this},n.clz32=function(t){return new e(t).clz32()},n.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.cos(this.get(t,o)));return this},n.cos=function(t){return new e(t).cos()},n.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.cosh(this.get(t,o)));return this},n.cosh=function(t){return new e(t).cosh()},n.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.exp(this.get(t,o)));return this},n.exp=function(t){return new e(t).exp()},n.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.expm1(this.get(t,o)));return this},n.expm1=function(t){return new e(t).expm1()},n.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.floor(this.get(t,o)));return this},n.floor=function(t){return new e(t).floor()},n.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.fround(this.get(t,o)));return this},n.fround=function(t){return new e(t).fround()},n.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log(this.get(t,o)));return this},n.log=function(t){return new e(t).log()},n.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log1p(this.get(t,o)));return this},n.log1p=function(t){return new e(t).log1p()},n.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log10(this.get(t,o)));return this},n.log10=function(t){return new e(t).log10()},n.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.log2(this.get(t,o)));return this},n.log2=function(t){return new e(t).log2()},n.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.round(this.get(t,o)));return this},n.round=function(t){return new e(t).round()},n.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sign(this.get(t,o)));return this},n.sign=function(t){return new e(t).sign()},n.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sin(this.get(t,o)));return this},n.sin=function(t){return new e(t).sin()},n.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sinh(this.get(t,o)));return this},n.sinh=function(t){return new e(t).sinh()},n.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.sqrt(this.get(t,o)));return this},n.sqrt=function(t){return new e(t).sqrt()},n.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.tan(this.get(t,o)));return this},n.tan=function(t){return new e(t).tan()},n.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.tanh(this.get(t,o)));return this},n.tanh=function(t){return new e(t).tanh()},n.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.set(t,o,Math.trunc(this.get(t,o)));return this},n.trunc=function(t){return new e(t).trunc()},n.pow=function(t,o){return new e(t).pow(o)},n.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},n.prototype.powS=function(t){for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)**t);return this},n.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let o=0;o<this.rows;o++)for(let r=0;r<this.columns;r++)this.set(o,r,this.get(o,r)**t.get(o,r));return this}}function J(n,e,s){let t=s?n.rows:n.rows-1;if(e<0||e>t)throw new RangeError("Row index out of range")}function X(n,e,s){let t=s?n.columns:n.columns-1;if(e<0||e>t)throw new RangeError("Column index out of range")}function ut(n,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==n.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function ft(n,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==n.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function $t(n,e){if(!U.isAnyArray(e))throw new TypeError("row indices must be an array");for(let s=0;s<e.length;s++)if(e[s]<0||e[s]>=n.rows)throw new RangeError("row indices are out of range")}function Ft(n,e){if(!U.isAnyArray(e))throw new TypeError("column indices must be an array");for(let s=0;s<e.length;s++)if(e[s]<0||e[s]>=n.columns)throw new RangeError("column indices are out of range")}function xt(n,e,s,t,o){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(Mt("startRow",e),Mt("endRow",s),Mt("startColumn",t),Mt("endColumn",o),e>s||t>o||e<0||e>=n.rows||s<0||s>=n.rows||t<0||t>=n.columns||o<0||o>=n.columns)throw new RangeError("Submatrix indices are out of range")}function kt(n,e=0){let s=[];for(let t=0;t<n;t++)s.push(e);return s}function Mt(n,e){if(typeof e!="number")throw new TypeError(`${n} must be a number`)}function lt(n){if(n.isEmpty())throw new Error("Empty matrix has no elements to index")}function ke(n){let e=kt(n.rows);for(let s=0;s<n.rows;++s)for(let t=0;t<n.columns;++t)e[s]+=n.get(s,t);return e}function ve(n){let e=kt(n.columns);for(let s=0;s<n.rows;++s)for(let t=0;t<n.columns;++t)e[t]+=n.get(s,t);return e}function Re(n){let e=0;for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)e+=n.get(s,t);return e}function Te(n){let e=kt(n.rows,1);for(let s=0;s<n.rows;++s)for(let t=0;t<n.columns;++t)e[s]*=n.get(s,t);return e}function Ie(n){let e=kt(n.columns,1);for(let s=0;s<n.rows;++s)for(let t=0;t<n.columns;++t)e[t]*=n.get(s,t);return e}function Ne(n){let e=1;for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)e*=n.get(s,t);return e}function qe(n,e,s){const t=n.rows,o=n.columns,r=[];for(let i=0;i<t;i++){let h=0,l=0,u=0;for(let g=0;g<o;g++)u=n.get(i,g)-s[i],h+=u,l+=u*u;e?r.push((l-h*h/o)/(o-1)):r.push((l-h*h/o)/o)}return r}function xe(n,e,s){const t=n.rows,o=n.columns,r=[];for(let i=0;i<o;i++){let h=0,l=0,u=0;for(let g=0;g<t;g++)u=n.get(g,i)-s[i],h+=u,l+=u*u;e?r.push((l-h*h/t)/(t-1)):r.push((l-h*h/t)/t)}return r}function De(n,e,s){const t=n.rows,o=n.columns,r=t*o;let i=0,h=0,l=0;for(let u=0;u<t;u++)for(let g=0;g<o;g++)l=n.get(u,g)-s,i+=l,h+=l*l;return e?(h-i*i/r)/(r-1):(h-i*i/r)/r}function $e(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)-e[s])}function Fe(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)-e[t])}function Ce(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)-e)}function ze(n){const e=[];for(let s=0;s<n.rows;s++){let t=0;for(let o=0;o<n.columns;o++)t+=n.get(s,o)**2/(n.columns-1);e.push(Math.sqrt(t))}return e}function Ve(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)/e[s])}function Pe(n){const e=[];for(let s=0;s<n.columns;s++){let t=0;for(let o=0;o<n.rows;o++)t+=n.get(o,s)**2/(n.rows-1);e.push(Math.sqrt(t))}return e}function Le(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)/e[t])}function Oe(n){const e=n.size-1;let s=0;for(let t=0;t<n.columns;t++)for(let o=0;o<n.rows;o++)s+=n.get(o,t)**2/e;return Math.sqrt(s)}function Be(n,e){for(let s=0;s<n.rows;s++)for(let t=0;t<n.columns;t++)n.set(s,t,n.get(s,t)/e)}class N{static from1DArray(e,s,t){if(e*s!==t.length)throw new RangeError("data length does not match given dimensions");let r=new E(e,s);for(let i=0;i<e;i++)for(let h=0;h<s;h++)r.set(i,h,t[i*s+h]);return r}static rowVector(e){let s=new E(1,e.length);for(let t=0;t<e.length;t++)s.set(0,t,e[t]);return s}static columnVector(e){let s=new E(e.length,1);for(let t=0;t<e.length;t++)s.set(t,0,e[t]);return s}static zeros(e,s){return new E(e,s)}static ones(e,s){return new E(e,s).fill(1)}static rand(e,s,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:o=Math.random}=t;let r=new E(e,s);for(let i=0;i<e;i++)for(let h=0;h<s;h++)r.set(i,h,o());return r}static randInt(e,s,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:o=0,max:r=1e3,random:i=Math.random}=t;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(r))throw new TypeError("max must be an integer");if(o>=r)throw new RangeError("min must be smaller than max");let h=r-o,l=new E(e,s);for(let u=0;u<e;u++)for(let g=0;g<s;g++){let f=o+Math.round(i()*h);l.set(u,g,f)}return l}static eye(e,s,t){s===void 0&&(s=e),t===void 0&&(t=1);let o=Math.min(e,s),r=this.zeros(e,s);for(let i=0;i<o;i++)r.set(i,i,t);return r}static diag(e,s,t){let o=e.length;s===void 0&&(s=o),t===void 0&&(t=s);let r=Math.min(o,s,t),i=this.zeros(s,t);for(let h=0;h<r;h++)i.set(h,h,e[h]);return i}static min(e,s){e=this.checkMatrix(e),s=this.checkMatrix(s);let t=e.rows,o=e.columns,r=new E(t,o);for(let i=0;i<t;i++)for(let h=0;h<o;h++)r.set(i,h,Math.min(e.get(i,h),s.get(i,h)));return r}static max(e,s){e=this.checkMatrix(e),s=this.checkMatrix(s);let t=e.rows,o=e.columns,r=new this(t,o);for(let i=0;i<t;i++)for(let h=0;h<o;h++)r.set(i,h,Math.max(e.get(i,h),s.get(i,h)));return r}static checkMatrix(e){return N.isMatrix(e)?e:new E(e)}static isMatrix(e){return e!=null&&e.klass==="Matrix"}get size(){return this.rows*this.columns}apply(e){if(typeof e!="function")throw new TypeError("callback must be a function");for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)e.call(this,s,t);return this}to1DArray(){let e=[];for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)e.push(this.get(s,t));return e}to2DArray(){let e=[];for(let s=0;s<this.rows;s++){e.push([]);for(let t=0;t<this.columns;t++)e[s].push(this.get(s,t))}return e}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let e=0;e<this.rows;e++)for(let s=0;s<=e;s++)if(this.get(e,s)!==this.get(s,e))return!1;return!0}return!1}isDistance(){if(!this.isSymmetric())return!1;for(let e=0;e<this.rows;e++)if(this.get(e,e)!==0)return!1;return!0}isEchelonForm(){let e=0,s=0,t=-1,o=!0,r=!1;for(;e<this.rows&&o;){for(s=0,r=!1;s<this.columns&&r===!1;)this.get(e,s)===0?s++:this.get(e,s)===1&&s>t?(r=!0,t=s):(o=!1,r=!0);e++}return o}isReducedEchelonForm(){let e=0,s=0,t=-1,o=!0,r=!1;for(;e<this.rows&&o;){for(s=0,r=!1;s<this.columns&&r===!1;)this.get(e,s)===0?s++:this.get(e,s)===1&&s>t?(r=!0,t=s):(o=!1,r=!0);for(let i=s+1;i<this.rows;i++)this.get(e,i)!==0&&(o=!1);e++}return o}echelonForm(){let e=this.clone(),s=0,t=0;for(;s<e.rows&&t<e.columns;){let o=s;for(let r=s;r<e.rows;r++)e.get(r,t)>e.get(o,t)&&(o=r);if(e.get(o,t)===0)t++;else{e.swapRows(s,o);let r=e.get(s,t);for(let i=t;i<e.columns;i++)e.set(s,i,e.get(s,i)/r);for(let i=s+1;i<e.rows;i++){let h=e.get(i,t)/e.get(s,t);e.set(i,t,0);for(let l=t+1;l<e.columns;l++)e.set(i,l,e.get(i,l)-e.get(s,l)*h)}s++,t++}}return e}reducedEchelonForm(){let e=this.echelonForm(),s=e.columns,t=e.rows,o=t-1;for(;o>=0;)if(e.maxRow(o)===0)o--;else{let r=0,i=!1;for(;r<t&&i===!1;)e.get(o,r)===1?i=!0:r++;for(let h=0;h<o;h++){let l=e.get(h,r);for(let u=r;u<s;u++){let g=e.get(h,u)-l*e.get(o,u);e.set(h,u,g)}}o--}return e}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{rows:s=1,columns:t=1}=e;if(!Number.isInteger(s)||s<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let o=new E(this.rows*s,this.columns*t);for(let r=0;r<s;r++)for(let i=0;i<t;i++)o.setSubMatrix(this,this.rows*r,this.columns*i);return o}fill(e){for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,e);return this}neg(){return this.mulS(-1)}getRow(e){J(this,e);let s=[];for(let t=0;t<this.columns;t++)s.push(this.get(e,t));return s}getRowVector(e){return E.rowVector(this.getRow(e))}setRow(e,s){J(this,e),s=ut(this,s);for(let t=0;t<this.columns;t++)this.set(e,t,s[t]);return this}swapRows(e,s){J(this,e),J(this,s);for(let t=0;t<this.columns;t++){let o=this.get(e,t);this.set(e,t,this.get(s,t)),this.set(s,t,o)}return this}getColumn(e){X(this,e);let s=[];for(let t=0;t<this.rows;t++)s.push(this.get(t,e));return s}getColumnVector(e){return E.columnVector(this.getColumn(e))}setColumn(e,s){X(this,e),s=ft(this,s);for(let t=0;t<this.rows;t++)this.set(t,e,s[t]);return this}swapColumns(e,s){X(this,e),X(this,s);for(let t=0;t<this.rows;t++){let o=this.get(t,e);this.set(t,e,this.get(t,s)),this.set(t,s,o)}return this}addRowVector(e){e=ut(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)+e[t]);return this}subRowVector(e){e=ut(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)-e[t]);return this}mulRowVector(e){e=ut(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)*e[t]);return this}divRowVector(e){e=ut(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)/e[t]);return this}addColumnVector(e){e=ft(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)+e[s]);return this}subColumnVector(e){e=ft(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)-e[s]);return this}mulColumnVector(e){e=ft(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)*e[s]);return this}divColumnVector(e){e=ft(this,e);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)this.set(s,t,this.get(s,t)/e[s]);return this}mulRow(e,s){J(this,e);for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*s);return this}mulColumn(e,s){X(this,e);for(let t=0;t<this.rows;t++)this.set(t,e,this.get(t,e)*s);return this}max(e){if(this.isEmpty())return NaN;switch(e){case"row":{const s=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>s[t]&&(s[t]=this.get(t,o));return s}case"column":{const s=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>s[o]&&(s[o]=this.get(t,o));return s}case void 0:{let s=this.get(0,0);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>s&&(s=this.get(t,o));return s}default:throw new Error(`invalid option: ${e}`)}}maxIndex(){lt(this);let e=this.get(0,0),s=[0,0];for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)>e&&(e=this.get(t,o),s[0]=t,s[1]=o);return s}min(e){if(this.isEmpty())return NaN;switch(e){case"row":{const s=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<s[t]&&(s[t]=this.get(t,o));return s}case"column":{const s=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<s[o]&&(s[o]=this.get(t,o));return s}case void 0:{let s=this.get(0,0);for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<s&&(s=this.get(t,o));return s}default:throw new Error(`invalid option: ${e}`)}}minIndex(){lt(this);let e=this.get(0,0),s=[0,0];for(let t=0;t<this.rows;t++)for(let o=0;o<this.columns;o++)this.get(t,o)<e&&(e=this.get(t,o),s[0]=t,s[1]=o);return s}maxRow(e){if(J(this,e),this.isEmpty())return NaN;let s=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)>s&&(s=this.get(e,t));return s}maxRowIndex(e){J(this,e),lt(this);let s=this.get(e,0),t=[e,0];for(let o=1;o<this.columns;o++)this.get(e,o)>s&&(s=this.get(e,o),t[1]=o);return t}minRow(e){if(J(this,e),this.isEmpty())return NaN;let s=this.get(e,0);for(let t=1;t<this.columns;t++)this.get(e,t)<s&&(s=this.get(e,t));return s}minRowIndex(e){J(this,e),lt(this);let s=this.get(e,0),t=[e,0];for(let o=1;o<this.columns;o++)this.get(e,o)<s&&(s=this.get(e,o),t[1]=o);return t}maxColumn(e){if(X(this,e),this.isEmpty())return NaN;let s=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)>s&&(s=this.get(t,e));return s}maxColumnIndex(e){X(this,e),lt(this);let s=this.get(0,e),t=[0,e];for(let o=1;o<this.rows;o++)this.get(o,e)>s&&(s=this.get(o,e),t[0]=o);return t}minColumn(e){if(X(this,e),this.isEmpty())return NaN;let s=this.get(0,e);for(let t=1;t<this.rows;t++)this.get(t,e)<s&&(s=this.get(t,e));return s}minColumnIndex(e){X(this,e),lt(this);let s=this.get(0,e),t=[0,e];for(let o=1;o<this.rows;o++)this.get(o,e)<s&&(s=this.get(o,e),t[0]=o);return t}diag(){let e=Math.min(this.rows,this.columns),s=[];for(let t=0;t<e;t++)s.push(this.get(t,t));return s}norm(e="frobenius"){switch(e){case"max":return this.max();case"frobenius":return Math.sqrt(this.dot(this));default:throw new RangeError(`unknown norm type: ${e}`)}}cumulativeSum(){let e=0;for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)e+=this.get(s,t),this.set(s,t,e);return this}dot(e){N.isMatrix(e)&&(e=e.to1DArray());let s=this.to1DArray();if(s.length!==e.length)throw new RangeError("vectors do not have the same size");let t=0;for(let o=0;o<s.length;o++)t+=s[o]*e[o];return t}mmul(e){e=E.checkMatrix(e);let s=this.rows,t=this.columns,o=e.columns,r=new E(s,o),i=new Float64Array(t);for(let h=0;h<o;h++){for(let l=0;l<t;l++)i[l]=e.get(l,h);for(let l=0;l<s;l++){let u=0;for(let g=0;g<t;g++)u+=this.get(l,g)*i[g];r.set(l,h,u)}}return r}mpow(e){if(!this.isSquare())throw new RangeError("Matrix must be square");if(!Number.isInteger(e)||e<0)throw new RangeError("Exponent must be a non-negative integer");let s=E.eye(this.rows),t=this;for(let o=e;o>=1;o/=2)o&1&&(s=s.mmul(t)),t=t.mmul(t);return s}strassen2x2(e){e=E.checkMatrix(e);let s=new E(2,2);const t=this.get(0,0),o=e.get(0,0),r=this.get(0,1),i=e.get(0,1),h=this.get(1,0),l=e.get(1,0),u=this.get(1,1),g=e.get(1,1),f=(t+u)*(o+g),m=(h+u)*o,S=t*(i-g),w=u*(l-o),p=(t+r)*g,b=(h-t)*(o+i),c=(r-u)*(l+g),M=f+w-p+c,k=S+p,T=m+w,I=f-m+S+b;return s.set(0,0,M),s.set(0,1,k),s.set(1,0,T),s.set(1,1,I),s}strassen3x3(e){e=E.checkMatrix(e);let s=new E(3,3);const t=this.get(0,0),o=this.get(0,1),r=this.get(0,2),i=this.get(1,0),h=this.get(1,1),l=this.get(1,2),u=this.get(2,0),g=this.get(2,1),f=this.get(2,2),m=e.get(0,0),S=e.get(0,1),w=e.get(0,2),p=e.get(1,0),b=e.get(1,1),c=e.get(1,2),M=e.get(2,0),k=e.get(2,1),T=e.get(2,2),I=(t+o+r-i-h-g-f)*b,C=(t-i)*(-S+b),v=h*(-m+S+p-b-c-M+T),R=(-t+i+h)*(m-S+b),$=(i+h)*(-m+S),a=t*m,d=(-t+u+g)*(m-w+c),j=(-t+u)*(w-c),y=(u+g)*(-m+w),z=(t+o+r-h-l-u-g)*c,D=g*(-m+w+p-b-c-M+k),F=(-r+g+f)*(b+M-k),V=(r-f)*(b-k),O=r*M,K=(g+f)*(-M+k),P=(-r+h+l)*(c+M-T),A=(r-l)*(c-T),H=(h+l)*(-M+T),x=o*p,B=l*k,W=i*w,Y=u*S,L=f*T,te=a+O+x,ee=I+R+$+a+F+O+K,se=a+d+y+z+O+P+H,oe=C+v+R+a+O+P+A,re=C+R+$+a+B,ne=O+P+A+H+W,ie=a+d+j+D+F+V+O,he=F+V+O+K+Y,le=a+d+j+y+L;return s.set(0,0,te),s.set(0,1,ee),s.set(0,2,se),s.set(1,0,oe),s.set(1,1,re),s.set(1,2,ne),s.set(2,0,ie),s.set(2,1,he),s.set(2,2,le),s}mmulStrassen(e){e=E.checkMatrix(e);let s=this.clone(),t=s.rows,o=s.columns,r=e.rows,i=e.columns;o!==r&&console.warn(`Multiplying ${t} x ${o} and ${r} x ${i} matrix: dimensions do not match.`);function h(f,m,S){let w=f.rows,p=f.columns;if(w===m&&p===S)return f;{let b=N.zeros(m,S);return b=b.setSubMatrix(f,0,0),b}}let l=Math.max(t,r),u=Math.max(o,i);s=h(s,l,u),e=h(e,l,u);function g(f,m,S,w){if(S<=512||w<=512)return f.mmul(m);S%2===1&&w%2===1?(f=h(f,S+1,w+1),m=h(m,S+1,w+1)):S%2===1?(f=h(f,S+1,w),m=h(m,S+1,w)):w%2===1&&(f=h(f,S,w+1),m=h(m,S,w+1));let p=parseInt(f.rows/2,10),b=parseInt(f.columns/2,10),c=f.subMatrix(0,p-1,0,b-1),M=m.subMatrix(0,p-1,0,b-1),k=f.subMatrix(0,p-1,b,f.columns-1),T=m.subMatrix(0,p-1,b,m.columns-1),I=f.subMatrix(p,f.rows-1,0,b-1),C=m.subMatrix(p,m.rows-1,0,b-1),v=f.subMatrix(p,f.rows-1,b,f.columns-1),R=m.subMatrix(p,m.rows-1,b,m.columns-1),$=g(N.add(c,v),N.add(M,R),p,b),a=g(N.add(I,v),M,p,b),d=g(c,N.sub(T,R),p,b),j=g(v,N.sub(C,M),p,b),y=g(N.add(c,k),R,p,b),z=g(N.sub(I,c),N.add(M,T),p,b),D=g(N.sub(k,v),N.add(C,R),p,b),F=N.add($,j);F.sub(y),F.add(D);let V=N.add(d,y),O=N.add(a,j),K=N.sub($,a);K.add(d),K.add(z);let P=N.zeros(2*F.rows,2*F.columns);return P=P.setSubMatrix(F,0,0),P=P.setSubMatrix(V,F.rows,0),P=P.setSubMatrix(O,0,F.columns),P=P.setSubMatrix(K,F.rows,F.columns),P.subMatrix(0,S-1,0,w-1)}return g(s,e,l,u)}scaleRows(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:s=0,max:t=1}=e;if(!Number.isFinite(s))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(s>=t)throw new RangeError("min must be smaller than max");let o=new E(this.rows,this.columns);for(let r=0;r<this.rows;r++){const i=this.getRow(r);i.length>0&&Vt(i,{min:s,max:t,output:i}),o.setRow(r,i)}return o}scaleColumns(e={}){if(typeof e!="object")throw new TypeError("options must be an object");const{min:s=0,max:t=1}=e;if(!Number.isFinite(s))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(s>=t)throw new RangeError("min must be smaller than max");let o=new E(this.rows,this.columns);for(let r=0;r<this.columns;r++){const i=this.getColumn(r);i.length&&Vt(i,{min:s,max:t,output:i}),o.setColumn(r,i)}return o}flipRows(){const e=Math.ceil(this.columns/2);for(let s=0;s<this.rows;s++)for(let t=0;t<e;t++){let o=this.get(s,t),r=this.get(s,this.columns-1-t);this.set(s,t,r),this.set(s,this.columns-1-t,o)}return this}flipColumns(){const e=Math.ceil(this.rows/2);for(let s=0;s<this.columns;s++)for(let t=0;t<e;t++){let o=this.get(t,s),r=this.get(this.rows-1-t,s);this.set(t,s,r),this.set(this.rows-1-t,s,o)}return this}kroneckerProduct(e){e=E.checkMatrix(e);let s=this.rows,t=this.columns,o=e.rows,r=e.columns,i=new E(s*o,t*r);for(let h=0;h<s;h++)for(let l=0;l<t;l++)for(let u=0;u<o;u++)for(let g=0;g<r;g++)i.set(o*h+u,r*l+g,this.get(h,l)*e.get(u,g));return i}kroneckerSum(e){if(e=E.checkMatrix(e),!this.isSquare()||!e.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let s=this.rows,t=e.rows,o=this.kroneckerProduct(E.eye(t,t)),r=E.eye(s,s).kroneckerProduct(e);return o.add(r)}transpose(){let e=new E(this.columns,this.rows);for(let s=0;s<this.rows;s++)for(let t=0;t<this.columns;t++)e.set(t,s,this.get(s,t));return e}sortRows(e=Lt){for(let s=0;s<this.rows;s++)this.setRow(s,this.getRow(s).sort(e));return this}sortColumns(e=Lt){for(let s=0;s<this.columns;s++)this.setColumn(s,this.getColumn(s).sort(e));return this}subMatrix(e,s,t,o){xt(this,e,s,t,o);let r=new E(s-e+1,o-t+1);for(let i=e;i<=s;i++)for(let h=t;h<=o;h++)r.set(i-e,h-t,this.get(i,h));return r}subMatrixRow(e,s,t){if(s===void 0&&(s=0),t===void 0&&(t=this.columns-1),s>t||s<0||s>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let o=new E(e.length,t-s+1);for(let r=0;r<e.length;r++)for(let i=s;i<=t;i++){if(e[r]<0||e[r]>=this.rows)throw new RangeError(`Row index out of range: ${e[r]}`);o.set(r,i-s,this.get(e[r],i))}return o}subMatrixColumn(e,s,t){if(s===void 0&&(s=0),t===void 0&&(t=this.rows-1),s>t||s<0||s>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let o=new E(t-s+1,e.length);for(let r=0;r<e.length;r++)for(let i=s;i<=t;i++){if(e[r]<0||e[r]>=this.columns)throw new RangeError(`Column index out of range: ${e[r]}`);o.set(i-s,r,this.get(i,e[r]))}return o}setSubMatrix(e,s,t){if(e=E.checkMatrix(e),e.isEmpty())return this;let o=s+e.rows-1,r=t+e.columns-1;xt(this,s,o,t,r);for(let i=0;i<e.rows;i++)for(let h=0;h<e.columns;h++)this.set(s+i,t+h,e.get(i,h));return this}selection(e,s){$t(this,e),Ft(this,s);let t=new E(e.length,s.length);for(let o=0;o<e.length;o++){let r=e[o];for(let i=0;i<s.length;i++){let h=s[i];t.set(o,i,this.get(r,h))}}return t}trace(){let e=Math.min(this.rows,this.columns),s=0;for(let t=0;t<e;t++)s+=this.get(t,t);return s}clone(){return this.constructor.copy(this,new E(this.rows,this.columns))}static copy(e,s){for(const[t,o,r]of e.entries())s.set(t,o,r);return s}sum(e){switch(e){case"row":return ke(this);case"column":return ve(this);case void 0:return Re(this);default:throw new Error(`invalid option: ${e}`)}}product(e){switch(e){case"row":return Te(this);case"column":return Ie(this);case void 0:return Ne(this);default:throw new Error(`invalid option: ${e}`)}}mean(e){const s=this.sum(e);switch(e){case"row":{for(let t=0;t<this.rows;t++)s[t]/=this.columns;return s}case"column":{for(let t=0;t<this.columns;t++)s[t]/=this.rows;return s}case void 0:return s/this.size;default:throw new Error(`invalid option: ${e}`)}}variance(e,s={}){if(typeof e=="object"&&(s=e,e=void 0),typeof s!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:o=this.mean(e)}=s;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(e){case"row":{if(!U.isAnyArray(o))throw new TypeError("mean must be an array");return qe(this,t,o)}case"column":{if(!U.isAnyArray(o))throw new TypeError("mean must be an array");return xe(this,t,o)}case void 0:{if(typeof o!="number")throw new TypeError("mean must be a number");return De(this,t,o)}default:throw new Error(`invalid option: ${e}`)}}standardDeviation(e,s){typeof e=="object"&&(s=e,e=void 0);const t=this.variance(e,s);if(e===void 0)return Math.sqrt(t);for(let o=0;o<t.length;o++)t[o]=Math.sqrt(t[o]);return t}center(e,s={}){if(typeof e=="object"&&(s=e,e=void 0),typeof s!="object")throw new TypeError("options must be an object");const{center:t=this.mean(e)}=s;switch(e){case"row":{if(!U.isAnyArray(t))throw new TypeError("center must be an array");return $e(this,t),this}case"column":{if(!U.isAnyArray(t))throw new TypeError("center must be an array");return Fe(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return Ce(this,t),this}default:throw new Error(`invalid option: ${e}`)}}scale(e,s={}){if(typeof e=="object"&&(s=e,e=void 0),typeof s!="object")throw new TypeError("options must be an object");let t=s.scale;switch(e){case"row":{if(t===void 0)t=ze(this);else if(!U.isAnyArray(t))throw new TypeError("scale must be an array");return Ve(this,t),this}case"column":{if(t===void 0)t=Pe(this);else if(!U.isAnyArray(t))throw new TypeError("scale must be an array");return Le(this,t),this}case void 0:{if(t===void 0)t=Oe(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return Be(this,t),this}default:throw new Error(`invalid option: ${e}`)}}toString(e){return Qt(this,e)}[Symbol.iterator](){return this.entries()}*entries(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)yield[e,s,this.get(e,s)]}*values(){for(let e=0;e<this.rows;e++)for(let s=0;s<this.columns;s++)yield this.get(e,s)}}N.prototype.klass="Matrix";typeof Symbol<"u"&&(N.prototype[Symbol.for("nodejs.util.inspect.custom")]=Se);function Lt(n,e){return n-e}function _e(n){return n.every(e=>typeof e=="number")}N.random=N.rand;N.randomInt=N.randInt;N.diagonal=N.diag;N.prototype.diagonal=N.prototype.diag;N.identity=N.eye;N.prototype.negate=N.prototype.neg;N.prototype.tensorProduct=N.prototype.kroneckerProduct;var pt,Dt,it;let E=(it=class extends N{constructor(s,t){super();It(this,pt);G(this,"data");if(it.isMatrix(s))Nt(this,pt,Dt).call(this,s.rows,s.columns),it.copy(s,this);else if(Number.isInteger(s)&&s>=0)Nt(this,pt,Dt).call(this,s,t);else if(U.isAnyArray(s)){const o=s;if(s=o.length,t=s?o[0].length:0,typeof t!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let r=0;r<s;r++){if(o[r].length!==t)throw new RangeError("Inconsistent array dimensions");if(!_e(o[r]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(o[r]))}this.rows=s,this.columns=t}else throw new TypeError("First argument must be a positive number or an array")}set(s,t,o){return this.data[s][t]=o,this}get(s,t){return this.data[s][t]}removeRow(s){return J(this,s),this.data.splice(s,1),this.rows-=1,this}addRow(s,t){return t===void 0&&(t=s,s=this.rows),J(this,s,!0),t=Float64Array.from(ut(this,t)),this.data.splice(s,0,t),this.rows+=1,this}removeColumn(s){X(this,s);for(let t=0;t<this.rows;t++){const o=new Float64Array(this.columns-1);for(let r=0;r<s;r++)o[r]=this.data[t][r];for(let r=s+1;r<this.columns;r++)o[r-1]=this.data[t][r];this.data[t]=o}return this.columns-=1,this}addColumn(s,t){typeof t>"u"&&(t=s,s=this.columns),X(this,s,!0),t=ft(this,t);for(let o=0;o<this.rows;o++){const r=new Float64Array(this.columns+1);let i=0;for(;i<s;i++)r[i]=this.data[o][i];for(r[i++]=t[o];i<this.columns+1;i++)r[i]=this.data[o][i-1];this.data[o]=r}return this.columns+=1,this}},pt=new WeakSet,Dt=function(s,t){if(this.data=[],Number.isInteger(t)&&t>=0)for(let o=0;o<s;o++)this.data.push(new Float64Array(t));else throw new TypeError("nColumns must be a positive integer");this.rows=s,this.columns=t},it);je(N,E);var _;const jt=class jt extends N{constructor(s){super();It(this,_);if(E.isMatrix(s)){if(!s.isSymmetric())throw new TypeError("not symmetric data");dt(this,_,E.copy(s,new E(s.rows,s.rows)))}else if(Number.isInteger(s)&&s>=0)dt(this,_,new E(s,s));else if(dt(this,_,new E(s)),!this.isSymmetric())throw new TypeError("not symmetric data")}get size(){return Z(this,_).size}get rows(){return Z(this,_).rows}get columns(){return Z(this,_).columns}get diagonalSize(){return this.rows}static isSymmetricMatrix(s){return E.isMatrix(s)&&s.klassType==="SymmetricMatrix"}static zeros(s){return new this(s)}static ones(s){return new this(s).fill(1)}clone(){const s=new jt(this.diagonalSize);for(const[t,o,r]of this.upperRightEntries())s.set(t,o,r);return s}toMatrix(){return new E(this)}get(s,t){return Z(this,_).get(s,t)}set(s,t,o){return Z(this,_).set(s,t,o),Z(this,_).set(t,s,o),this}removeCross(s){return Z(this,_).removeRow(s),Z(this,_).removeColumn(s),this}addCross(s,t){t===void 0&&(t=s,s=this.diagonalSize);const o=t.slice();return o.splice(s,1),Z(this,_).addRow(s,o),Z(this,_).addColumn(s,t),this}applyMask(s){if(s.length!==this.diagonalSize)throw new RangeError("Mask size do not match with matrix size");const t=[];for(const[o,r]of s.entries())r||t.push(o);t.reverse();for(const o of t)this.removeCross(o);return this}toCompact(){const{diagonalSize:s}=this,t=new Array(s*(s+1)/2);for(let o=0,r=0,i=0;i<t.length;i++)t[i]=this.get(r,o),++o>=s&&(o=++r);return t}static fromCompact(s){const t=s.length,o=(Math.sqrt(8*t+1)-1)/2;if(!Number.isInteger(o))throw new TypeError(`This array is not a compact representation of a Symmetric Matrix, ${JSON.stringify(s)}`);const r=new jt(o);for(let i=0,h=0,l=0;l<t;l++)r.set(i,h,s[l]),++i>=o&&(i=++h);return r}*upperRightEntries(){for(let s=0,t=0;s<this.diagonalSize;void 0){const o=this.get(s,t);yield[s,t,o],++t>=this.diagonalSize&&(t=++s)}}*upperRightValues(){for(let s=0,t=0;s<this.diagonalSize;void 0)yield this.get(s,t),++t>=this.diagonalSize&&(t=++s)}};_=new WeakMap;let nt=jt;nt.prototype.klassType="SymmetricMatrix";class vt extends nt{static isDistanceMatrix(e){return nt.isSymmetricMatrix(e)&&e.klassSubType==="DistanceMatrix"}constructor(e){if(super(e),!this.isDistance())throw new TypeError("Provided arguments do no produce a distance matrix")}set(e,s,t){return e===s&&(t=0),super.set(e,s,t)}addCross(e,s){return s===void 0&&(s=e,e=this.diagonalSize),s=s.slice(),s[e]=0,super.addCross(e,s)}toSymmetricMatrix(){return new nt(this)}clone(){const e=new vt(this.diagonalSize);for(const[s,t,o]of this.upperRightEntries())s!==t&&e.set(s,t,o);return e}toCompact(){const{diagonalSize:e}=this,s=(e-1)*e/2,t=new Array(s);for(let o=1,r=0,i=0;i<t.length;i++)t[i]=this.get(r,o),++o>=e&&(o=++r+1);return t}static fromCompact(e){const s=e.length;if(s===0)return new this(0);const t=(Math.sqrt(8*s+1)+1)/2;if(!Number.isInteger(t))throw new TypeError(`This array is not a compact representation of a DistanceMatrix, ${JSON.stringify(e)}`);const o=new this(t);for(let r=1,i=0,h=0;h<s;h++)o.set(r,i,e[h]),++r>=t&&(r=++i+1);return o}}vt.prototype.klassSubType="DistanceMatrix";class et extends N{constructor(e,s,t){super(),this.matrix=e,this.rows=s,this.columns=t}}class Ue extends et{constructor(e,s){X(e,s),super(e,e.rows,1),this.column=s}set(e,s,t){return this.matrix.set(e,this.column,t),this}get(e){return this.matrix.get(e,this.column)}}class We extends et{constructor(e,s){Ft(e,s),super(e,e.rows,s.length),this.columnIndices=s}set(e,s,t){return this.matrix.set(e,this.columnIndices[s],t),this}get(e,s){return this.matrix.get(e,this.columnIndices[s])}}class Ye extends et{constructor(e){super(e,e.rows,e.columns)}set(e,s,t){return this.matrix.set(e,this.columns-s-1,t),this}get(e,s){return this.matrix.get(e,this.columns-s-1)}}class Qe extends et{constructor(e){super(e,e.rows,e.columns)}set(e,s,t){return this.matrix.set(this.rows-e-1,s,t),this}get(e,s){return this.matrix.get(this.rows-e-1,s)}}class Ge extends et{constructor(e,s){J(e,s),super(e,1,e.columns),this.row=s}set(e,s,t){return this.matrix.set(this.row,s,t),this}get(e,s){return this.matrix.get(this.row,s)}}class Je extends et{constructor(e,s){$t(e,s),super(e,s.length,e.columns),this.rowIndices=s}set(e,s,t){return this.matrix.set(this.rowIndices[e],s,t),this}get(e,s){return this.matrix.get(this.rowIndices[e],s)}}class Et extends et{constructor(e,s,t){$t(e,s),Ft(e,t),super(e,s.length,t.length),this.rowIndices=s,this.columnIndices=t}set(e,s,t){return this.matrix.set(this.rowIndices[e],this.columnIndices[s],t),this}get(e,s){return this.matrix.get(this.rowIndices[e],this.columnIndices[s])}}class Xe extends et{constructor(e,s,t,o,r){xt(e,s,t,o,r),super(e,t-s+1,r-o+1),this.startRow=s,this.startColumn=o}set(e,s,t){return this.matrix.set(this.startRow+e,this.startColumn+s,t),this}get(e,s){return this.matrix.get(this.startRow+e,this.startColumn+s)}}class Ke extends et{constructor(e){super(e,e.columns,e.rows)}set(e,s,t){return this.matrix.set(s,e,t),this}get(e,s){return this.matrix.get(s,e)}}class Gt extends N{constructor(e,s={}){const{rows:t=1}=s;if(e.length%t!==0)throw new Error("the data length is not divisible by the number of rows");super(),this.rows=t,this.columns=e.length/t,this.data=e}set(e,s,t){let o=this._calculateIndex(e,s);return this.data[o]=t,this}get(e,s){let t=this._calculateIndex(e,s);return this.data[t]}_calculateIndex(e,s){return e*this.columns+s}}class Q extends N{constructor(e){super(),this.data=e,this.rows=e.length,this.columns=e[0].length}set(e,s,t){return this.data[e][s]=t,this}get(e,s){return this.data[e][s]}}function Ze(n,e){if(U.isAnyArray(n))return n[0]&&U.isAnyArray(n[0])?new Q(n):new Gt(n,e);throw new Error("the argument is not an array")}class Rt{constructor(e){e=Q.checkMatrix(e);let s=e.clone(),t=s.rows,o=s.columns,r=new Float64Array(t),i=1,h,l,u,g,f,m,S,w,p;for(h=0;h<t;h++)r[h]=h;for(w=new Float64Array(t),l=0;l<o;l++){for(h=0;h<t;h++)w[h]=s.get(h,l);for(h=0;h<t;h++){for(p=Math.min(h,l),f=0,u=0;u<p;u++)f+=s.get(h,u)*w[u];w[h]-=f,s.set(h,l,w[h])}for(g=l,h=l+1;h<t;h++)Math.abs(w[h])>Math.abs(w[g])&&(g=h);if(g!==l){for(u=0;u<o;u++)m=s.get(g,u),s.set(g,u,s.get(l,u)),s.set(l,u,m);S=r[g],r[g]=r[l],r[l]=S,i=-i}if(l<t&&s.get(l,l)!==0)for(h=l+1;h<t;h++)s.set(h,l,s.get(h,l)/s.get(l,l))}this.LU=s,this.pivotVector=r,this.pivotSign=i}isSingular(){let e=this.LU,s=e.columns;for(let t=0;t<s;t++)if(e.get(t,t)===0)return!0;return!1}solve(e){e=E.checkMatrix(e);let s=this.LU;if(s.rows!==e.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let o=e.columns,r=e.subMatrixRow(this.pivotVector,0,o-1),i=s.columns,h,l,u;for(u=0;u<i;u++)for(h=u+1;h<i;h++)for(l=0;l<o;l++)r.set(h,l,r.get(h,l)-r.get(u,l)*s.get(h,u));for(u=i-1;u>=0;u--){for(l=0;l<o;l++)r.set(u,l,r.get(u,l)/s.get(u,u));for(h=0;h<u;h++)for(l=0;l<o;l++)r.set(h,l,r.get(h,l)-r.get(u,l)*s.get(h,u))}return r}get determinant(){let e=this.LU;if(!e.isSquare())throw new Error("Matrix must be square");let s=this.pivotSign,t=e.columns;for(let o=0;o<t;o++)s*=e.get(o,o);return s}get lowerTriangularMatrix(){let e=this.LU,s=e.rows,t=e.columns,o=new E(s,t);for(let r=0;r<s;r++)for(let i=0;i<t;i++)r>i?o.set(r,i,e.get(r,i)):r===i?o.set(r,i,1):o.set(r,i,0);return o}get upperTriangularMatrix(){let e=this.LU,s=e.rows,t=e.columns,o=new E(s,t);for(let r=0;r<s;r++)for(let i=0;i<t;i++)r<=i?o.set(r,i,e.get(r,i)):o.set(r,i,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function tt(n,e){let s=0;return Math.abs(n)>Math.abs(e)?(s=e/n,Math.abs(n)*Math.sqrt(1+s*s)):e!==0?(s=n/e,Math.abs(e)*Math.sqrt(1+s*s)):0}class Ct{constructor(e){e=Q.checkMatrix(e);let s=e.clone(),t=e.rows,o=e.columns,r=new Float64Array(o),i,h,l,u;for(l=0;l<o;l++){let g=0;for(i=l;i<t;i++)g=tt(g,s.get(i,l));if(g!==0){for(s.get(l,l)<0&&(g=-g),i=l;i<t;i++)s.set(i,l,s.get(i,l)/g);for(s.set(l,l,s.get(l,l)+1),h=l+1;h<o;h++){for(u=0,i=l;i<t;i++)u+=s.get(i,l)*s.get(i,h);for(u=-u/s.get(l,l),i=l;i<t;i++)s.set(i,h,s.get(i,h)+u*s.get(i,l))}}r[l]=-g}this.QR=s,this.Rdiag=r}solve(e){e=E.checkMatrix(e);let s=this.QR,t=s.rows;if(e.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o=e.columns,r=e.clone(),i=s.columns,h,l,u,g;for(u=0;u<i;u++)for(l=0;l<o;l++){for(g=0,h=u;h<t;h++)g+=s.get(h,u)*r.get(h,l);for(g=-g/s.get(u,u),h=u;h<t;h++)r.set(h,l,r.get(h,l)+g*s.get(h,u))}for(u=i-1;u>=0;u--){for(l=0;l<o;l++)r.set(u,l,r.get(u,l)/this.Rdiag[u]);for(h=0;h<u;h++)for(l=0;l<o;l++)r.set(h,l,r.get(h,l)-r.get(u,l)*s.get(h,u))}return r.subMatrix(0,i-1,0,o-1)}isFullRank(){let e=this.QR.columns;for(let s=0;s<e;s++)if(this.Rdiag[s]===0)return!1;return!0}get upperTriangularMatrix(){let e=this.QR,s=e.columns,t=new E(s,s),o,r;for(o=0;o<s;o++)for(r=0;r<s;r++)o<r?t.set(o,r,e.get(o,r)):o===r?t.set(o,r,this.Rdiag[o]):t.set(o,r,0);return t}get orthogonalMatrix(){let e=this.QR,s=e.rows,t=e.columns,o=new E(s,t),r,i,h,l;for(h=t-1;h>=0;h--){for(r=0;r<s;r++)o.set(r,h,0);for(o.set(h,h,1),i=h;i<t;i++)if(e.get(h,h)!==0){for(l=0,r=h;r<s;r++)l+=e.get(r,h)*o.get(r,i);for(l=-l/e.get(h,h),r=h;r<s;r++)o.set(r,i,o.get(r,i)+l*e.get(r,h))}}return o}}class at{constructor(e,s={}){if(e=Q.checkMatrix(e),e.isEmpty())throw new Error("Matrix must be non-empty");let t=e.rows,o=e.columns;const{computeLeftSingularVectors:r=!0,computeRightSingularVectors:i=!0,autoTranspose:h=!1}=s;let l=!!r,u=!!i,g=!1,f;if(t<o)if(!h)f=e.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{f=e.transpose(),t=f.rows,o=f.columns,g=!0;let a=l;l=u,u=a}else f=e.clone();let m=Math.min(t,o),S=Math.min(t+1,o),w=new Float64Array(S),p=new E(t,m),b=new E(o,o),c=new Float64Array(o),M=new Float64Array(t),k=new Float64Array(S);for(let a=0;a<S;a++)k[a]=a;let T=Math.min(t-1,o),I=Math.max(0,Math.min(o-2,t)),C=Math.max(T,I);for(let a=0;a<C;a++){if(a<T){w[a]=0;for(let d=a;d<t;d++)w[a]=tt(w[a],f.get(d,a));if(w[a]!==0){f.get(a,a)<0&&(w[a]=-w[a]);for(let d=a;d<t;d++)f.set(d,a,f.get(d,a)/w[a]);f.set(a,a,f.get(a,a)+1)}w[a]=-w[a]}for(let d=a+1;d<o;d++){if(a<T&&w[a]!==0){let j=0;for(let y=a;y<t;y++)j+=f.get(y,a)*f.get(y,d);j=-j/f.get(a,a);for(let y=a;y<t;y++)f.set(y,d,f.get(y,d)+j*f.get(y,a))}c[d]=f.get(a,d)}if(l&&a<T)for(let d=a;d<t;d++)p.set(d,a,f.get(d,a));if(a<I){c[a]=0;for(let d=a+1;d<o;d++)c[a]=tt(c[a],c[d]);if(c[a]!==0){c[a+1]<0&&(c[a]=0-c[a]);for(let d=a+1;d<o;d++)c[d]/=c[a];c[a+1]+=1}if(c[a]=-c[a],a+1<t&&c[a]!==0){for(let d=a+1;d<t;d++)M[d]=0;for(let d=a+1;d<t;d++)for(let j=a+1;j<o;j++)M[d]+=c[j]*f.get(d,j);for(let d=a+1;d<o;d++){let j=-c[d]/c[a+1];for(let y=a+1;y<t;y++)f.set(y,d,f.get(y,d)+j*M[y])}}if(u)for(let d=a+1;d<o;d++)b.set(d,a,c[d])}}let v=Math.min(o,t+1);if(T<o&&(w[T]=f.get(T,T)),t<v&&(w[v-1]=0),I+1<v&&(c[I]=f.get(I,v-1)),c[v-1]=0,l){for(let a=T;a<m;a++){for(let d=0;d<t;d++)p.set(d,a,0);p.set(a,a,1)}for(let a=T-1;a>=0;a--)if(w[a]!==0){for(let d=a+1;d<m;d++){let j=0;for(let y=a;y<t;y++)j+=p.get(y,a)*p.get(y,d);j=-j/p.get(a,a);for(let y=a;y<t;y++)p.set(y,d,p.get(y,d)+j*p.get(y,a))}for(let d=a;d<t;d++)p.set(d,a,-p.get(d,a));p.set(a,a,1+p.get(a,a));for(let d=0;d<a-1;d++)p.set(d,a,0)}else{for(let d=0;d<t;d++)p.set(d,a,0);p.set(a,a,1)}}if(u)for(let a=o-1;a>=0;a--){if(a<I&&c[a]!==0)for(let d=a+1;d<o;d++){let j=0;for(let y=a+1;y<o;y++)j+=b.get(y,a)*b.get(y,d);j=-j/b.get(a+1,a);for(let y=a+1;y<o;y++)b.set(y,d,b.get(y,d)+j*b.get(y,a))}for(let d=0;d<o;d++)b.set(d,a,0);b.set(a,a,1)}let R=v-1,$=Number.EPSILON;for(;v>0;){let a,d;for(a=v-2;a>=-1&&a!==-1;a--){const j=Number.MIN_VALUE+$*Math.abs(w[a]+Math.abs(w[a+1]));if(Math.abs(c[a])<=j||Number.isNaN(c[a])){c[a]=0;break}}if(a===v-2)d=4;else{let j;for(j=v-1;j>=a&&j!==a;j--){let y=(j!==v?Math.abs(c[j]):0)+(j!==a+1?Math.abs(c[j-1]):0);if(Math.abs(w[j])<=$*y){w[j]=0;break}}j===a?d=3:j===v-1?d=1:(d=2,a=j)}switch(a++,d){case 1:{let j=c[v-2];c[v-2]=0;for(let y=v-2;y>=a;y--){let z=tt(w[y],j),D=w[y]/z,F=j/z;if(w[y]=z,y!==a&&(j=-F*c[y-1],c[y-1]=D*c[y-1]),u)for(let V=0;V<o;V++)z=D*b.get(V,y)+F*b.get(V,v-1),b.set(V,v-1,-F*b.get(V,y)+D*b.get(V,v-1)),b.set(V,y,z)}break}case 2:{let j=c[a-1];c[a-1]=0;for(let y=a;y<v;y++){let z=tt(w[y],j),D=w[y]/z,F=j/z;if(w[y]=z,j=-F*c[y],c[y]=D*c[y],l)for(let V=0;V<t;V++)z=D*p.get(V,y)+F*p.get(V,a-1),p.set(V,a-1,-F*p.get(V,y)+D*p.get(V,a-1)),p.set(V,y,z)}break}case 3:{const j=Math.max(Math.abs(w[v-1]),Math.abs(w[v-2]),Math.abs(c[v-2]),Math.abs(w[a]),Math.abs(c[a])),y=w[v-1]/j,z=w[v-2]/j,D=c[v-2]/j,F=w[a]/j,V=c[a]/j,O=((z+y)*(z-y)+D*D)/2,K=y*D*(y*D);let P=0;(O!==0||K!==0)&&(O<0?P=0-Math.sqrt(O*O+K):P=Math.sqrt(O*O+K),P=K/(O+P));let A=(F+y)*(F-y)+P,H=F*V;for(let x=a;x<v-1;x++){let B=tt(A,H);B===0&&(B=Number.MIN_VALUE);let W=A/B,Y=H/B;if(x!==a&&(c[x-1]=B),A=W*w[x]+Y*c[x],c[x]=W*c[x]-Y*w[x],H=Y*w[x+1],w[x+1]=W*w[x+1],u)for(let L=0;L<o;L++)B=W*b.get(L,x)+Y*b.get(L,x+1),b.set(L,x+1,-Y*b.get(L,x)+W*b.get(L,x+1)),b.set(L,x,B);if(B=tt(A,H),B===0&&(B=Number.MIN_VALUE),W=A/B,Y=H/B,w[x]=B,A=W*c[x]+Y*w[x+1],w[x+1]=-Y*c[x]+W*w[x+1],H=Y*c[x+1],c[x+1]=W*c[x+1],l&&x<t-1)for(let L=0;L<t;L++)B=W*p.get(L,x)+Y*p.get(L,x+1),p.set(L,x+1,-Y*p.get(L,x)+W*p.get(L,x+1)),p.set(L,x,B)}c[v-2]=A;break}case 4:{if(w[a]<=0&&(w[a]=w[a]<0?-w[a]:0,u))for(let j=0;j<=R;j++)b.set(j,a,-b.get(j,a));for(;a<R&&!(w[a]>=w[a+1]);){let j=w[a];if(w[a]=w[a+1],w[a+1]=j,u&&a<o-1)for(let y=0;y<o;y++)j=b.get(y,a+1),b.set(y,a+1,b.get(y,a)),b.set(y,a,j);if(l&&a<t-1)for(let y=0;y<t;y++)j=p.get(y,a+1),p.set(y,a+1,p.get(y,a)),p.set(y,a,j);a++}v--;break}}}if(g){let a=b;b=p,p=a}this.m=t,this.n=o,this.s=w,this.U=p,this.V=b}solve(e){let s=e,t=this.threshold,o=this.s.length,r=E.zeros(o,o);for(let m=0;m<o;m++)Math.abs(this.s[m])<=t?r.set(m,m,0):r.set(m,m,1/this.s[m]);let i=this.U,h=this.rightSingularVectors,l=h.mmul(r),u=h.rows,g=i.rows,f=E.zeros(u,g);for(let m=0;m<u;m++)for(let S=0;S<g;S++){let w=0;for(let p=0;p<o;p++)w+=l.get(m,p)*i.get(S,p);f.set(m,S,w)}return f.mmul(s)}solveForDiagonal(e){return this.solve(E.diag(e))}inverse(){let e=this.V,s=this.threshold,t=e.rows,o=e.columns,r=new E(t,this.s.length);for(let g=0;g<t;g++)for(let f=0;f<o;f++)Math.abs(this.s[f])>s&&r.set(g,f,e.get(g,f)/this.s[f]);let i=this.U,h=i.rows,l=i.columns,u=new E(t,h);for(let g=0;g<t;g++)for(let f=0;f<h;f++){let m=0;for(let S=0;S<l;S++)m+=r.get(g,S)*i.get(f,S);u.set(g,f,m)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let e=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,s=0,t=this.s;for(let o=0,r=t.length;o<r;o++)t[o]>e&&s++;return s}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return E.diag(this.s)}}function Ae(n,e=!1){return n=Q.checkMatrix(n),e?new at(n).inverse():Jt(n,E.eye(n.rows))}function Jt(n,e,s=!1){return n=Q.checkMatrix(n),e=Q.checkMatrix(e),s?new at(n).solve(e):n.isSquare()?new Rt(n).solve(e):new Ct(n).solve(e)}function bt(n){if(n=E.checkMatrix(n),n.isSquare()){if(n.columns===0)return 1;let e,s,t,o;if(n.columns===2)return e=n.get(0,0),s=n.get(0,1),t=n.get(1,0),o=n.get(1,1),e*o-s*t;if(n.columns===3){let r,i,h;return r=new Et(n,[1,2],[1,2]),i=new Et(n,[1,2],[0,2]),h=new Et(n,[1,2],[0,1]),e=n.get(0,0),s=n.get(0,1),t=n.get(0,2),e*bt(r)-s*bt(i)+t*bt(h)}else return new Rt(n).determinant}else throw Error("determinant can only be calculated for a square matrix")}function He(n,e){let s=[];for(let t=0;t<n;t++)t!==e&&s.push(t);return s}function ts(n,e,s,t=1e-9,o=1e-9){if(n>o)return new Array(e.rows+1).fill(0);{let r=e.addRow(s,[0]);for(let i=0;i<r.rows;i++)Math.abs(r.get(i,0))<t&&r.set(i,0,0);return r.to1DArray()}}function es(n,e={}){const{thresholdValue:s=1e-9,thresholdError:t=1e-9}=e;n=E.checkMatrix(n);let o=n.rows,r=new E(o,o);for(let i=0;i<o;i++){let h=E.columnVector(n.getRow(i)),l=n.subMatrixRow(He(o,i)).transpose(),g=new at(l).solve(h),f=E.sub(h,l.mmul(g)).abs().max();r.setRow(i,ts(f,g,i,s,t))}return r}function ss(n,e=Number.EPSILON){if(n=E.checkMatrix(n),n.isEmpty())return n.transpose();let s=new at(n,{autoTranspose:!0}),t=s.leftSingularVectors,o=s.rightSingularVectors,r=s.diagonal;for(let i=0;i<r.length;i++)Math.abs(r[i])>e?r[i]=1/r[i]:r[i]=0;return o.mmul(E.diag(r).mmul(t.transpose()))}function os(n,e=n,s={}){n=new E(n);let t=!1;if(typeof e=="object"&&!E.isMatrix(e)&&!U.isAnyArray(e)?(s=e,e=n,t=!0):e=new E(e),n.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0}=s;o&&(n=n.center("column"),t||(e=e.center("column")));const r=n.transpose().mmul(e);for(let i=0;i<r.rows;i++)for(let h=0;h<r.columns;h++)r.set(i,h,r.get(i,h)*(1/(n.rows-1)));return r}function rs(n,e=n,s={}){n=new E(n);let t=!1;if(typeof e=="object"&&!E.isMatrix(e)&&!U.isAnyArray(e)?(s=e,e=n,t=!0):e=new E(e),n.rows!==e.rows)throw new TypeError("Both matrices must have the same number of rows");const{center:o=!0,scale:r=!0}=s;o&&(n.center("column"),t||e.center("column")),r&&(n.scale("column"),t||e.scale("column"));const i=n.standardDeviation("column",{unbiased:!0}),h=t?i:e.standardDeviation("column",{unbiased:!0}),l=n.transpose().mmul(e);for(let u=0;u<l.rows;u++)for(let g=0;g<l.columns;g++)l.set(u,g,l.get(u,g)*(1/(i[u]*h[g]))*(1/(n.rows-1)));return l}class Xt{constructor(e,s={}){const{assumeSymmetric:t=!1}=s;if(e=Q.checkMatrix(e),!e.isSquare())throw new Error("Matrix is not a square matrix");if(e.isEmpty())throw new Error("Matrix must be non-empty");let o=e.columns,r=new E(o,o),i=new Float64Array(o),h=new Float64Array(o),l=e,u,g,f=!1;if(t?f=!0:f=e.isSymmetric(),f){for(u=0;u<o;u++)for(g=0;g<o;g++)r.set(u,g,l.get(u,g));ns(o,h,i,r),is(o,h,i,r)}else{let m=new E(o,o),S=new Float64Array(o);for(g=0;g<o;g++)for(u=0;u<o;u++)m.set(u,g,l.get(u,g));hs(o,m,S,r),ls(o,h,i,r,m)}this.n=o,this.e=h,this.d=i,this.V=r}get realEigenvalues(){return Array.from(this.d)}get imaginaryEigenvalues(){return Array.from(this.e)}get eigenvectorMatrix(){return this.V}get diagonalMatrix(){let e=this.n,s=this.e,t=this.d,o=new E(e,e),r,i;for(r=0;r<e;r++){for(i=0;i<e;i++)o.set(r,i,0);o.set(r,r,t[r]),s[r]>0?o.set(r,r+1,s[r]):s[r]<0&&o.set(r,r-1,s[r])}return o}}function ns(n,e,s,t){let o,r,i,h,l,u,g,f;for(l=0;l<n;l++)s[l]=t.get(n-1,l);for(h=n-1;h>0;h--){for(f=0,i=0,u=0;u<h;u++)f=f+Math.abs(s[u]);if(f===0)for(e[h]=s[h-1],l=0;l<h;l++)s[l]=t.get(h-1,l),t.set(h,l,0),t.set(l,h,0);else{for(u=0;u<h;u++)s[u]/=f,i+=s[u]*s[u];for(o=s[h-1],r=Math.sqrt(i),o>0&&(r=-r),e[h]=f*r,i=i-o*r,s[h-1]=o-r,l=0;l<h;l++)e[l]=0;for(l=0;l<h;l++){for(o=s[l],t.set(l,h,o),r=e[l]+t.get(l,l)*o,u=l+1;u<=h-1;u++)r+=t.get(u,l)*s[u],e[u]+=t.get(u,l)*o;e[l]=r}for(o=0,l=0;l<h;l++)e[l]/=i,o+=e[l]*s[l];for(g=o/(i+i),l=0;l<h;l++)e[l]-=g*s[l];for(l=0;l<h;l++){for(o=s[l],r=e[l],u=l;u<=h-1;u++)t.set(u,l,t.get(u,l)-(o*e[u]+r*s[u]));s[l]=t.get(h-1,l),t.set(h,l,0)}}s[h]=i}for(h=0;h<n-1;h++){if(t.set(n-1,h,t.get(h,h)),t.set(h,h,1),i=s[h+1],i!==0){for(u=0;u<=h;u++)s[u]=t.get(u,h+1)/i;for(l=0;l<=h;l++){for(r=0,u=0;u<=h;u++)r+=t.get(u,h+1)*t.get(u,l);for(u=0;u<=h;u++)t.set(u,l,t.get(u,l)-r*s[u])}}for(u=0;u<=h;u++)t.set(u,h+1,0)}for(l=0;l<n;l++)s[l]=t.get(n-1,l),t.set(n-1,l,0);t.set(n-1,n-1,1),e[0]=0}function is(n,e,s,t){let o,r,i,h,l,u,g,f,m,S,w,p,b,c,M,k;for(i=1;i<n;i++)e[i-1]=e[i];e[n-1]=0;let T=0,I=0,C=Number.EPSILON;for(u=0;u<n;u++){for(I=Math.max(I,Math.abs(s[u])+Math.abs(e[u])),g=u;g<n&&!(Math.abs(e[g])<=C*I);)g++;if(g>u)do{for(o=s[u],f=(s[u+1]-o)/(2*e[u]),m=tt(f,1),f<0&&(m=-m),s[u]=e[u]/(f+m),s[u+1]=e[u]*(f+m),S=s[u+1],r=o-s[u],i=u+2;i<n;i++)s[i]-=r;for(T=T+r,f=s[g],w=1,p=w,b=w,c=e[u+1],M=0,k=0,i=g-1;i>=u;i--)for(b=p,p=w,k=M,o=w*e[i],r=w*f,m=tt(f,e[i]),e[i+1]=M*m,M=e[i]/m,w=f/m,f=w*s[i]-M*o,s[i+1]=r+M*(w*o+M*s[i]),l=0;l<n;l++)r=t.get(l,i+1),t.set(l,i+1,M*t.get(l,i)+w*r),t.set(l,i,w*t.get(l,i)-M*r);f=-M*k*b*c*e[u]/S,e[u]=M*f,s[u]=w*f}while(Math.abs(e[u])>C*I);s[u]=s[u]+T,e[u]=0}for(i=0;i<n-1;i++){for(l=i,f=s[i],h=i+1;h<n;h++)s[h]<f&&(l=h,f=s[h]);if(l!==i)for(s[l]=s[i],s[i]=f,h=0;h<n;h++)f=t.get(h,i),t.set(h,i,t.get(h,l)),t.set(h,l,f)}}function hs(n,e,s,t){let o=0,r=n-1,i,h,l,u,g,f,m;for(f=o+1;f<=r-1;f++){for(m=0,u=f;u<=r;u++)m=m+Math.abs(e.get(u,f-1));if(m!==0){for(l=0,u=r;u>=f;u--)s[u]=e.get(u,f-1)/m,l+=s[u]*s[u];for(h=Math.sqrt(l),s[f]>0&&(h=-h),l=l-s[f]*h,s[f]=s[f]-h,g=f;g<n;g++){for(i=0,u=r;u>=f;u--)i+=s[u]*e.get(u,g);for(i=i/l,u=f;u<=r;u++)e.set(u,g,e.get(u,g)-i*s[u])}for(u=0;u<=r;u++){for(i=0,g=r;g>=f;g--)i+=s[g]*e.get(u,g);for(i=i/l,g=f;g<=r;g++)e.set(u,g,e.get(u,g)-i*s[g])}s[f]=m*s[f],e.set(f,f-1,m*h)}}for(u=0;u<n;u++)for(g=0;g<n;g++)t.set(u,g,u===g?1:0);for(f=r-1;f>=o+1;f--)if(e.get(f,f-1)!==0){for(u=f+1;u<=r;u++)s[u]=e.get(u,f-1);for(g=f;g<=r;g++){for(h=0,u=f;u<=r;u++)h+=s[u]*t.get(u,g);for(h=h/s[f]/e.get(f,f-1),u=f;u<=r;u++)t.set(u,g,t.get(u,g)+h*s[u])}}}function ls(n,e,s,t,o){let r=n-1,i=0,h=n-1,l=Number.EPSILON,u=0,g=0,f=0,m=0,S=0,w=0,p=0,b=0,c,M,k,T,I,C,v,R,$,a,d,j,y,z,D;for(c=0;c<n;c++)for((c<i||c>h)&&(s[c]=o.get(c,c),e[c]=0),M=Math.max(c-1,0);M<n;M++)g=g+Math.abs(o.get(c,M));for(;r>=i;){for(T=r;T>i&&(w=Math.abs(o.get(T-1,T-1))+Math.abs(o.get(T,T)),w===0&&(w=g),!(Math.abs(o.get(T,T-1))<l*w));)T--;if(T===r)o.set(r,r,o.get(r,r)+u),s[r]=o.get(r,r),e[r]=0,r--,b=0;else if(T===r-1){if(v=o.get(r,r-1)*o.get(r-1,r),f=(o.get(r-1,r-1)-o.get(r,r))/2,m=f*f+v,p=Math.sqrt(Math.abs(m)),o.set(r,r,o.get(r,r)+u),o.set(r-1,r-1,o.get(r-1,r-1)+u),R=o.get(r,r),m>=0){for(p=f>=0?f+p:f-p,s[r-1]=R+p,s[r]=s[r-1],p!==0&&(s[r]=R-v/p),e[r-1]=0,e[r]=0,R=o.get(r,r-1),w=Math.abs(R)+Math.abs(p),f=R/w,m=p/w,S=Math.sqrt(f*f+m*m),f=f/S,m=m/S,M=r-1;M<n;M++)p=o.get(r-1,M),o.set(r-1,M,m*p+f*o.get(r,M)),o.set(r,M,m*o.get(r,M)-f*p);for(c=0;c<=r;c++)p=o.get(c,r-1),o.set(c,r-1,m*p+f*o.get(c,r)),o.set(c,r,m*o.get(c,r)-f*p);for(c=i;c<=h;c++)p=t.get(c,r-1),t.set(c,r-1,m*p+f*t.get(c,r)),t.set(c,r,m*t.get(c,r)-f*p)}else s[r-1]=R+f,s[r]=R+f,e[r-1]=p,e[r]=-p;r=r-2,b=0}else{if(R=o.get(r,r),$=0,v=0,T<r&&($=o.get(r-1,r-1),v=o.get(r,r-1)*o.get(r-1,r)),b===10){for(u+=R,c=i;c<=r;c++)o.set(c,c,o.get(c,c)-R);w=Math.abs(o.get(r,r-1))+Math.abs(o.get(r-1,r-2)),R=$=.75*w,v=-.4375*w*w}if(b===30&&(w=($-R)/2,w=w*w+v,w>0)){for(w=Math.sqrt(w),$<R&&(w=-w),w=R-v/(($-R)/2+w),c=i;c<=r;c++)o.set(c,c,o.get(c,c)-w);u+=w,R=$=v=.964}for(b=b+1,I=r-2;I>=T&&(p=o.get(I,I),S=R-p,w=$-p,f=(S*w-v)/o.get(I+1,I)+o.get(I,I+1),m=o.get(I+1,I+1)-p-S-w,S=o.get(I+2,I+1),w=Math.abs(f)+Math.abs(m)+Math.abs(S),f=f/w,m=m/w,S=S/w,!(I===T||Math.abs(o.get(I,I-1))*(Math.abs(m)+Math.abs(S))<l*(Math.abs(f)*(Math.abs(o.get(I-1,I-1))+Math.abs(p)+Math.abs(o.get(I+1,I+1))))));)I--;for(c=I+2;c<=r;c++)o.set(c,c-2,0),c>I+2&&o.set(c,c-3,0);for(k=I;k<=r-1&&(z=k!==r-1,k!==I&&(f=o.get(k,k-1),m=o.get(k+1,k-1),S=z?o.get(k+2,k-1):0,R=Math.abs(f)+Math.abs(m)+Math.abs(S),R!==0&&(f=f/R,m=m/R,S=S/R)),R!==0);k++)if(w=Math.sqrt(f*f+m*m+S*S),f<0&&(w=-w),w!==0){for(k!==I?o.set(k,k-1,-w*R):T!==I&&o.set(k,k-1,-o.get(k,k-1)),f=f+w,R=f/w,$=m/w,p=S/w,m=m/f,S=S/f,M=k;M<n;M++)f=o.get(k,M)+m*o.get(k+1,M),z&&(f=f+S*o.get(k+2,M),o.set(k+2,M,o.get(k+2,M)-f*p)),o.set(k,M,o.get(k,M)-f*R),o.set(k+1,M,o.get(k+1,M)-f*$);for(c=0;c<=Math.min(r,k+3);c++)f=R*o.get(c,k)+$*o.get(c,k+1),z&&(f=f+p*o.get(c,k+2),o.set(c,k+2,o.get(c,k+2)-f*S)),o.set(c,k,o.get(c,k)-f),o.set(c,k+1,o.get(c,k+1)-f*m);for(c=i;c<=h;c++)f=R*t.get(c,k)+$*t.get(c,k+1),z&&(f=f+p*t.get(c,k+2),t.set(c,k+2,t.get(c,k+2)-f*S)),t.set(c,k,t.get(c,k)-f),t.set(c,k+1,t.get(c,k+1)-f*m)}}}if(g!==0){for(r=n-1;r>=0;r--)if(f=s[r],m=e[r],m===0)for(T=r,o.set(r,r,1),c=r-1;c>=0;c--){for(v=o.get(c,c)-f,S=0,M=T;M<=r;M++)S=S+o.get(c,M)*o.get(M,r);if(e[c]<0)p=v,w=S;else if(T=c,e[c]===0?o.set(c,r,v!==0?-S/v:-S/(l*g)):(R=o.get(c,c+1),$=o.get(c+1,c),m=(s[c]-f)*(s[c]-f)+e[c]*e[c],C=(R*w-p*S)/m,o.set(c,r,C),o.set(c+1,r,Math.abs(R)>Math.abs(p)?(-S-v*C)/R:(-w-$*C)/p)),C=Math.abs(o.get(c,r)),l*C*C>1)for(M=c;M<=r;M++)o.set(M,r,o.get(M,r)/C)}else if(m<0)for(T=r-1,Math.abs(o.get(r,r-1))>Math.abs(o.get(r-1,r))?(o.set(r-1,r-1,m/o.get(r,r-1)),o.set(r-1,r,-(o.get(r,r)-f)/o.get(r,r-1))):(D=St(0,-o.get(r-1,r),o.get(r-1,r-1)-f,m),o.set(r-1,r-1,D[0]),o.set(r-1,r,D[1])),o.set(r,r-1,0),o.set(r,r,1),c=r-2;c>=0;c--){for(a=0,d=0,M=T;M<=r;M++)a=a+o.get(c,M)*o.get(M,r-1),d=d+o.get(c,M)*o.get(M,r);if(v=o.get(c,c)-f,e[c]<0)p=v,S=a,w=d;else if(T=c,e[c]===0?(D=St(-a,-d,v,m),o.set(c,r-1,D[0]),o.set(c,r,D[1])):(R=o.get(c,c+1),$=o.get(c+1,c),j=(s[c]-f)*(s[c]-f)+e[c]*e[c]-m*m,y=(s[c]-f)*2*m,j===0&&y===0&&(j=l*g*(Math.abs(v)+Math.abs(m)+Math.abs(R)+Math.abs($)+Math.abs(p))),D=St(R*S-p*a+m*d,R*w-p*d-m*a,j,y),o.set(c,r-1,D[0]),o.set(c,r,D[1]),Math.abs(R)>Math.abs(p)+Math.abs(m)?(o.set(c+1,r-1,(-a-v*o.get(c,r-1)+m*o.get(c,r))/R),o.set(c+1,r,(-d-v*o.get(c,r)-m*o.get(c,r-1))/R)):(D=St(-S-$*o.get(c,r-1),-w-$*o.get(c,r),p,m),o.set(c+1,r-1,D[0]),o.set(c+1,r,D[1]))),C=Math.max(Math.abs(o.get(c,r-1)),Math.abs(o.get(c,r))),l*C*C>1)for(M=c;M<=r;M++)o.set(M,r-1,o.get(M,r-1)/C),o.set(M,r,o.get(M,r)/C)}for(c=0;c<n;c++)if(c<i||c>h)for(M=c;M<n;M++)t.set(c,M,o.get(c,M));for(M=n-1;M>=i;M--)for(c=i;c<=h;c++){for(p=0,k=i;k<=Math.min(M,h);k++)p=p+t.get(c,k)*o.get(k,M);t.set(c,M,p)}}}function St(n,e,s,t){let o,r;return Math.abs(s)>Math.abs(t)?(o=t/s,r=s+o*t,[(n+o*e)/r,(e-o*n)/r]):(o=s/t,r=t+o*s,[(o*n+e)/r,(o*e-n)/r])}class Kt{constructor(e){if(e=Q.checkMatrix(e),!e.isSymmetric())throw new Error("Matrix is not symmetric");let s=e,t=s.rows,o=new E(t,t),r=!0,i,h,l;for(h=0;h<t;h++){let u=0;for(l=0;l<h;l++){let g=0;for(i=0;i<l;i++)g+=o.get(l,i)*o.get(h,i);g=(s.get(h,l)-g)/o.get(l,l),o.set(h,l,g),u=u+g*g}for(u=s.get(h,h)-u,r&&(r=u>0),o.set(h,h,Math.sqrt(Math.max(u,0))),l=h+1;l<t;l++)o.set(h,l,0)}this.L=o,this.positiveDefinite=r}isPositiveDefinite(){return this.positiveDefinite}solve(e){e=Q.checkMatrix(e);let s=this.L,t=s.rows;if(e.rows!==t)throw new Error("Matrix dimensions do not match");if(this.isPositiveDefinite()===!1)throw new Error("Matrix is not positive definite");let o=e.columns,r=e.clone(),i,h,l;for(l=0;l<t;l++)for(h=0;h<o;h++){for(i=0;i<l;i++)r.set(l,h,r.get(l,h)-r.get(i,h)*s.get(l,i));r.set(l,h,r.get(l,h)/s.get(l,l))}for(l=t-1;l>=0;l--)for(h=0;h<o;h++){for(i=l+1;i<t;i++)r.set(l,h,r.get(l,h)-r.get(i,h)*s.get(i,l));r.set(l,h,r.get(l,h)/s.get(l,l))}return r}get lowerTriangularMatrix(){return this.L}}class Zt{constructor(e,s={}){e=Q.checkMatrix(e);let{Y:t}=s;const{scaleScores:o=!1,maxIterations:r=1e3,terminationCriteria:i=1e-10}=s;let h;if(t){if(U.isAnyArray(t)&&typeof t[0]=="number"?t=E.columnVector(t):t=Q.checkMatrix(t),t.rows!==e.rows)throw new Error("Y should have the same number of rows as X");h=t.getColumnVector(0)}else h=e.getColumnVector(0);let l=1,u,g,f,m;for(let S=0;S<r&&l>i;S++)f=e.transpose().mmul(h).div(h.transpose().mmul(h).get(0,0)),f=f.div(f.norm()),u=e.mmul(f).div(f.transpose().mmul(f).get(0,0)),S>0&&(l=u.clone().sub(m).pow(2).sum()),m=u.clone(),t?(g=t.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),g=g.div(g.norm()),h=t.mmul(g).div(g.transpose().mmul(g).get(0,0))):h=u;if(t){let S=e.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0));S=S.div(S.norm());let w=e.clone().sub(u.clone().mmul(S.transpose())),p=h.transpose().mmul(u).div(u.transpose().mmul(u).get(0,0)),b=t.clone().sub(u.clone().mulS(p.get(0,0)).mmul(g.transpose()));this.t=u,this.p=S.transpose(),this.w=f.transpose(),this.q=g,this.u=h,this.s=u.transpose().mmul(u),this.xResidual=w,this.yResidual=b,this.betas=p}else this.w=f.transpose(),this.s=u.transpose().mmul(u).sqrt(),o?this.t=u.clone().div(this.s.get(0,0)):this.t=u,this.xResidual=e.sub(u.mmul(f.transpose()))}}q.AbstractMatrix=N;q.CHO=Kt;q.CholeskyDecomposition=Kt;q.DistanceMatrix=vt;q.EVD=Xt;q.EigenvalueDecomposition=Xt;q.LU=Rt;q.LuDecomposition=Rt;var At=q.Matrix=E;q.MatrixColumnSelectionView=We;q.MatrixColumnView=Ue;q.MatrixFlipColumnView=Ye;q.MatrixFlipRowView=Qe;q.MatrixRowSelectionView=Je;q.MatrixRowView=Ge;q.MatrixSelectionView=Et;q.MatrixSubView=Xe;q.MatrixTransposeView=Ke;q.NIPALS=Zt;q.Nipals=Zt;q.QR=Ct;q.QrDecomposition=Ct;q.SVD=at;q.SingularValueDecomposition=at;q.SymmetricMatrix=nt;q.WrapperMatrix1D=Gt;q.WrapperMatrix2D=Q;q.correlation=rs;q.covariance=os;var Ot=q.default=E;q.determinant=bt;q.inverse=Ae;q.linearDependencies=es;q.pseudoInverse=ss;q.solve=Jt;q.wrap=Ze;const Bt=At;Ot.Matrix&&Ot.Matrix;class us{constructor(e,s){G(this,"weights",[]);G(this,"shape",[2,3,2]);this.init(e,s)}init(e,s){this.shape=[...e],this.weights=[];let t=0;for(let o=0;o<this.shape.length-1;++o){const r=this.shape[o]+1,i=this.shape[o+1],h=r*i;let l;if(s!==void 0){if(t+h>s.length)throw new Error(`Not enough weights provided for layer ${o}`);l=s.slice(t,t+h),t+=h}else l=Array.from({length:h},()=>Math.random()*2-1);this.weights.push(Bt.from1DArray(r,i,l))}if(s!==void 0&&t!==s.length)throw new Error(`Extra weights provided: expected ${t}, received ${s.length}`)}array(){const e=[];for(let s=0;s<this.weights.length;++s)e.push(...this.weights[s].to1DArray());return e}sigmoid(e){return 1/(1+Math.exp(-e))}evaluate(e){let s=[];for(let t=0;t<this.shape.length-1;++t){const o=t,r=this.weights[o];s=this.layer(e,r).map(this.sigmoid),e=s}return s}layer(e,s){return Bt.rowVector([...e,1]).mmul(s).to1DArray()}}class Ht{constructor(){G(this,"position",new st(0,0));G(this,"extents",new st(4,4));G(this,"marked",!1)}}const ct={};window.addEventListener("keydown",n=>{ct[n.key]=!0});window.addEventListener("keyup",n=>{ct[n.key]=!1});function fs(n){let e=0;function s(t){const o=(t-e)/1e3;e=t,n(o),requestAnimationFrame(s)}requestAnimationFrame(s)}function cs(n,e){n.fillStyle="blue",n.save(),n.translate(e.position.x+e.extents.x/2,e.position.y+e.extents.y/2),n.rotate(e.direction),n.fillRect(-e.extents.x/2,-e.extents.y/2,e.extents.x,e.extents.y),n.strokeStyle="yellow",n.lineWidth=e.extents.x/2,n.beginPath(),n.moveTo(0,0),n.lineTo(e.extents.y,0),n.closePath(),n.stroke(),n.restore()}function as(n,e){n.fillStyle="green",n.save(),n.translate(e.position.x+e.extents.x/2,e.position.y+e.extents.y/2),n.fillRect(-e.extents.x/2,-e.extents.y/2,e.extents.x,e.extents.y),n.restore()}function gs(n,e,s,t,o){n.save(),n.fillStyle="#888888",n.fillRect(0,0,t,o),n.restore();for(const r of e)cs(n,r);for(const r of s)as(n,r)}let qt=[],rt=[];const ws=new Ut,mt=[],ms=1920/1080,ot=640,ht=ot*ms;function ps(){const n=document.getElementById("app"),e=document.createElement("canvas");if(gt=e.getContext("2d"),n.appendChild(e),e.height=ot,e.width=ht,gt===null)throw Error("Could not get context from canvas.")}function ds(){let n=0,e=0;ct.q&&(n+=1),ct.a&&(n-=1),ct.w&&(e+=1),ct.s&&(e-=1),ws.input({left:n,right:e})}function ys(){for(let n=0;n<10;++n)mt.push({bot:new Ut([Math.random()*ht,Math.random()*ot]),brain:new us([2,3,2])});for(let n=0;n<100;++n){const e=new Ht;e.position.x=Math.random()*ht,e.position.y=Math.random()*ot,rt.push(e)}}function Ms(){for(const n of mt)n.bot.score=0,n.bot.position=new st(ht/2,ot/2);rt=[];for(let n=0;n<100;++n){const e=new Ht;e.position.x=Math.random()*ht,e.position.y=Math.random()*ot,rt.push(e)}}let gt;function Ss(n){if(!gt)throw new Error("Canvas context not initialized");gt.clearRect(0,0,ht,ot),ds();for(const e of mt){const s=e.brain.evaluate([1,1]);if(s.length!==2)throw Error("output of NN expected to be a 2 dimensional vector");e.bot.input({left:s[0],right:s[1]})}qt=mt.map(e=>e.bot);for(const e of qt){e.step(n);const s=e.position.x,t=e.position.y,o=s+e.extents.x,r=t+e.extents.y;for(const i of rt){const h=i.position.x,l=i.position.y,u=h+i.extents.x,g=l+i.extents.y;s<u&&o>h&&t<g&&r>l&&(i.marked=!0,e.score++,console.log(`Bot score: ${e.score}`))}rt=rt.filter(i=>!i.marked)}gs(gt,qt,rt,ht,ot)}function Es(){setTimeout(function e(){console.log("Evaluation"),console.log(mt.map(s=>s.bot.score).sort()),Ms(),setTimeout(e,1e4)},1e4)}function bs(){ps(),ys(),fs(Ss),Es()}bs();
